---
title: "Descriptive FLARe analyses"
author: "Thomas McGregor"
date: "`r Sys.Date()`"
output: html_document
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "../reports"
    )
  })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load packages, include=FALSE}
library(tidyverse)
library(here)
library(ComplexUpset)
```


```{r read in dataset, include=FALSE}
flare_data <- read_rds(here("data", "processed", "flare_data.Rds")) %>% 
  filter(started_app == TRUE)
```

Descriptive analyses for the FLARe dataset. Exclusions have not been applied and missing data has not been imputed.

# Potential exclusions
The following exclusion criteria were submitted in the preregistration:
- Self-reporting that they did not follow the instructions properly for the fear conditioning task (i.e. removed their headphones, did not pay attention, were interrupted)
-	Self-reporting that they did not find the aversive stimulus unpleasant (i.e. a rating of five out of ten or lower)
-	Missing six or more trial ratings during the acquisition or extinction phase of the fear conditioning task
-	Having an average device volume of 50% or lower during the acquisition phase of the fear conditioning task
-	Classified by Ieso Digital Health (who provided the CBT) as ineligible for treatment
-	Not completing at least two treatment sessions

## Self-reported task non-adherance
```{r task non-adherance, warning=FALSE}
# Recode variables so that TRUE is always a response that leads to exclusion
# Transmute so that only relevant variables are kept
task_non_adherance <- flare_data %>% 
  transmute(
    did_not_follow_instructions = if_else(did_follow_instructions == TRUE, FALSE, TRUE),
    did_remove_headphones,
    did_not_pay_attention = if_else(did_pay_attention == TRUE, FALSE, TRUE),
    completed_in_public = if_else(task_environment == "private", FALSE, TRUE),
    loud_environment = if_else(was_quiet == TRUE, FALSE, TRUE),
    not_alone,
    was_interrupted
  )

# Get a list of types of self reported exclusions to use as intersect in upset
self_reported_exclusions <- names(task_non_adherance)

# Create upset plot
upset(task_non_adherance, intersect = self_reported_exclusions,
      name="Self-reported task non-adherance by frequency (n = 271)")
      

```

# Headphone removal
When did they remove headphones
