---
title: "PORT: preliminary analyses"
author: "Thomas McGregor"
date: "`r Sys.Date()`"
output: html_document
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "../reports"
    )
  })
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r load packages, include=FALSE}
library(ppcor) # partial correlations
library(tidyverse) # data manipulation
library(here) # file referencing
library(ComplexUpset) # creating upset plots
library(gt) # creating tables
library(webshot) # required for saving gt tables
library(naniar)

```

```{r read in dataset, include=FALSE}
port_data <- read_rds(here("data", "processed", "07_imputed-processed-data.Rds"))
```

# Cleaning

```{r}
port_data_subsetted <- port_data %>% 
  filter(port_exclusion == FALSE) %>% 
  dplyr::select(
    gad7_treatment_total_final,
    gad7_treatment_total_final_observed,
    exp_acquisition_cs_minus_mean,
    exp_extinction_cs_plus_mean,
    gad7_treatment_total_1,
    ieso_treatment_completed_total,
    fss_baseline_total,
    fss_followup_total)

port_data_subsetted_clean <- na.omit(port_data_subsetted)


vis_miss(port_data_subsetted)
```

# Analyses

## Acquisition CS-

```{r}
acquisition_cs_minus_model <- port_data_subsetted %>% 
  lm(
    gad7_treatment_total_final_observed ~ exp_acquisition_cs_minus_mean + gad7_treatment_total_1 + ieso_treatment_completed_total, 
    data = .
  )

pcor.test(
  port_data_subsetted_clean$gad7_treatment_total_final_observed,
  port_data_subsetted_clean$exp_acquisition_cs_minus_mean,
  port_data_subsetted_clean$gad7_treatment_total_1,
  method="pearson"
)

summary(acquisition_cs_minus_model)

port_data_subsetted %>% 
  ggplot(aes(x = exp_acquisition_cs_minus_mean, y = gad7_treatment_total_final_observed)) +
  geom_point() + 
  geom_smooth(method=lm)
```

## Extinction CS+

```{r}
extinction_cs_plus_model <- port_data_subsetted %>% 
  lm(gad7_treatment_total_final_observed ~ exp_extinction_cs_plus_mean + gad7_treatment_total_1 + ieso_treatment_completed_total, data = .)

pcor.test(port_data_subsetted_clean$gad7_treatment_total_final_observed,
          port_data_subsetted_clean$exp_extinction_cs_plus_mean,
          port_data_subsetted_clean$gad7_treatment_total_1,
          method="pearson")

summary(extinction_cs_plus_model)

port_data_subsetted %>% 
  ggplot(aes(x = exp_extinction_cs_plus_mean, y = gad7_treatment_total_final_observed)) +
  geom_point() + 
  geom_smooth(method=lm)
```


## FSS

```{r}
fss_model <- port_data_subsetted %>% 
  lm(fss_followup_total ~ exp_extinction_cs_plus_mean + fss_baseline_total + ieso_treatment_completed_total, data = .)

pcor.test(port_data_subsetted_clean$fss_followup_total,
          port_data_subsetted_clean$exp_extinction_cs_plus_mean,
          port_data_subsetted_clean$fss_baseline_total,
          method="pearson")

summary(fss_model)

port_data_subsetted %>% 
  ggplot(aes(x = exp_extinction_cs_plus_mean, y = fss_followup_total)) +
  geom_point() + 
  geom_smooth(method=lm)
```